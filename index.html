<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¤ãƒ©ã‚¹ãƒˆç”³ã—è¾¼ã¿</title>
<meta name="robots" content="noai, noimageai, noindex, nofollow">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
/* --- ã‚¹ã‚¿ã‚¤ãƒ«ã¯å¤‰æ›´ãªã— --- */
body {
    background-color: #f7f9fc;
    display: flex;
    justify-content: center;
    padding: 40px;
    flex-direction: column;
    align-items: center;
}
.container {
    background: white;
    padding: 0;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 700px;
    box-sizing: border-box;
}
.content-wrapper {
    padding: 15px 40px;
}
.header-image {
    display: block;
    width: 100%;
    max-height: 250px;
    object-fit: cover;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
}
.disclaimer-container {
    padding: 15px 40px;
    border-top: 2px solid #ff91d7;
    border-bottom: 2px solid #ff91d7;
    text-align: center;
}
.disclaimer-container p {
    margin: 0;
    font-size: 14px;
    color: #000000;
    line-height: 1.6;
}
h2, h3 {
    color: #333;
}
h3 {
    font-size: 1.15em;
    font-weight: 600;
    margin-top: 40px;
    padding-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 2px solid #ff91d7;
}
.section-description {
    font-size: 14px;
    color: #666;
    margin: 4px 0 12px;
}
.required-note {
    color: #FF0000;
    font-size: 12px;
}
label {
    display: block;
    margin: 6px 0;
    color: #222;
}
input[type="text"],
input[type="email"],
textarea {
    font-size: 16px;
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
}
input[type="file"] {
    margin-bottom: 10px;
}
.input-error {
    border-color: red !important;
    outline: 1px solid red;
    background-color: #fff8f8;
}
label.highlight-error {
    color: red !important;
}
.error-message {
    color: red;
    font-size: 0.9em;
    margin: -10px 0 15px;
    line-height: 1.4;
    background-color: #fff0f0;
    padding: 6px 8px;
    border: 1px solid #ffcccc;
    border-radius: 4px;
}
.total {
    font-size: 1.3em;
    font-weight: bold;
    color: #1e7c27;
    text-align: center;
    margin-top: 24px;
}
.estimate-note {
    text-align: center;
    color: #555;
    font-size: 14px;
    margin-top: 10px;
    line-height: 1.5;
}
.preview img {
    max-width: 100%;
    max-height: 200px;
    margin-top: 10px;
    border-radius: 6px;
}
.preview-note {
    color: #d66;
    font-size: 0.9em;
    text-align: center;
    width: 100%;
    margin-top: 10px;
}
#optionPreview {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}
.optionImageWrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.optionImageWrapper .preview-note {
    font-size: 0.8em;
    margin-top: 5px;
}
#filePreviewContainer {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.file-preview-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background-color: #f4f4f9;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    font-size: 0.9em;
}
.file-preview-item span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-right: 10px;
}
.file-preview-item button {
    background-color: #ff4d4d;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 0.8em;
    line-height: 1;
}
.file-preview-item button:hover {
    background-color: #cc0000;
}
button[type="submit"] {
    background-color: #446dff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    width: 10em;
    cursor: pointer;
    margin-top: 30px;
    transition: all 0.3s ease;
}
button[type="submit"][disabled] {
    background-color: #888;
    cursor: not-allowed;
}
button[type="submit"]:hover:not([disabled]) {
    background-color: #ff69b4;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
#previewPanel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 270px;
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-top: 4px solid #ff8cc6;
    border-radius: 8px;
    box-shadow: 0 5px 18px rgba(0, 0, 0, 0.1);
    padding: 18px 22px;
    z-index: 1000;
    font-size: 13.5px;
    box-sizing: border-box;
}
#previewPanel h4 {
    font-size: 1.15em;
    color: #2c2c2c;
    margin: 0 0 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    align-items: center;
}
#previewPanel h4::before {
    content: 'ğŸ“‹';
    margin-right: 8px;
    font-size: 1.1em;
    color: #ff8cc6;
}
#previewPanel p {
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #f5f5f5;
    line-height: 1.4;
}
#previewPanel p:last-child {
    border-bottom: none;
    margin: 12px 0 0;
    padding: 12px 0 0;
    border-top: 1px solid #e9e9e9;
}
#previewPanel p strong {
    display: block;
    color: #444;
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 0.9em;
}
#previewPanel p span:not(.preview-total-highlight) {
    display: block;
    color: #333;
    padding-left: 8px;
    font-size: 0.95em;
    word-break: break-word;
    line-height: 1.55;
}
#previewPanel .preview-total-highlight {
    font-size: 1.65em;
    color: #1a650e;
    font-weight: bold;
    background-color: #e6f4e3;
    padding: 7px 14px;
    border-radius: 6px;
    display: inline-block;
    text-align: left;
    border: 1px solid #c8e6c1;
    margin-top: 4px;
}
.popup-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}
.popup-overlay img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}
.complete {
    text-align: center;
    padding: 40px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 20px auto;
}
.is-hidden {
    display: none !important;
}
#closeTabButton {
    background-color: #446dff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    width: 10em;
    cursor: pointer;
    margin-top: 20px;
    transition: all 0.3s ease;
}
#loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
}
.spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #ff69b4;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
#loadingText {
    margin-top: 20px;
    color: #555;
    font-size: 1.1em;
}
@media (max-width: 980px) {
    body { padding: 20px; }
    .content-wrapper { padding: 15px 20px; }
    .disclaimer-container { padding: 15px 20px; }
    #previewPanel {
        position: static;
        width: 100%;
        margin: 25px 0;
        padding: 15px 18px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        border-top-width: 3px;
    }
    #previewPanel h4 { font-size: 1.1em; margin-bottom: 15px; padding-bottom: 10px; }
    #previewPanel h4::before { font-size: 1em; }
    #previewPanel p { margin-bottom: 8px; padding-bottom: 8px; line-height: 1.3; }
    #previewPanel p strong { font-size: 0.85em; }
    #previewPanel p span:not(.preview-total-highlight) { font-size: 0.9em; padding-left: 6px; }
    #previewPanel .preview-total-highlight { font-size: 1.55em; padding: 6px 12px; }
}
@media (max-width: 600px) {
    body { padding: 15px; }
    .content-wrapper { padding: 15px; }
    h3 { font-size: 1.1em; }
    input[type="text"], input[type="email"], textarea { padding: 12px; }
    #previewPanel { padding: 12px 15px; margin: 20px 0; }
    #previewPanel h4 { font-size: 1.05em; }
    #previewPanel .preview-total-highlight { font-size: 1.45em; }
    #previewPanel p strong { font-size: 0.8em; }
    #previewPanel p span:not(.preview-total-highlight) { font-size: 0.85em; padding-left: 5px; }
}
@media print {
    img { display: none !important; }
}
</style>
</head>
<body>

<div class="container" id="formContainer">
  <img src="https://raw.githubusercontent.com/5442mako/image-host-/main/575758226550424048.webp" alt="ãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒ" class="header-image" loading="lazy" decoding="async">
  <div class="disclaimer-container">
    <p>
      â€»æœ¬ãƒšãƒ¼ã‚¸ã«æ²è¼‰ã•ã‚ŒãŸç”»åƒã®ç„¡æ–­è»¢è¼‰ãƒ»ç„¡æ–­ä½¿ç”¨ã‚’ç¦æ­¢ã€‚<br>
      â€»ä¸æ­£åˆ©ç”¨ãŒç™ºè¦šã—ãŸå ´åˆã€æå®³è«‹æ±‚ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚
    </p>
  </div>
  <div class="content-wrapper">
    <form id="estimateForm" action="#" method="POST">
      <h3 id="illustrationTypeSectionH3">ã€ã”å¸Œæœ›ã®ã‚¤ãƒ©ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã€‘<span class="required-note">â€»å¿…é ˆã€‚</span></h3>
      <label><input type="radio" name="type" value="5000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/image196.webp"> é¡”ã‚¢ãƒƒãƒ—ï¼ˆ5,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="8000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/575755441817780548.webp"> ãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—ï¼ˆ8,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="10000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/image107.webp"> è†ä¸Šï¼ˆ10,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="13000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/ã‚¤ãƒ©ã‚¹ãƒˆ210.webp"> å…¨èº«ï¼ˆ13,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="40000" > Live2Dç”¨ã‚¤ãƒ©ã‚¹ãƒˆãƒ‘ãƒ¼ãƒ„åˆ†ã‘ï¼ˆ40,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="25000" > Live2Dãƒã‚¹ãƒˆã‚¢ãƒƒãƒ—ï¼ˆ25,000å††ï¼‰</label>
      <label><input type="radio" name="type" value="15000" > ã‚­ãƒ£ãƒ©ãƒ»è¡£è£…ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆ15,000å††ï¼‰</label>
      <p id="typeErrorMessage" class="error-message is-hidden">â€»ã”å¸Œæœ›ã®ã‚¤ãƒ©ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
      <div id="typeImageBelowOptions" class="preview"></div>

      <h3>ã€è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ã€‘<span class="required-note">â€»å¿…é ˆã€‚</span></h3>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="3000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/image209.webp"> èƒŒæ™¯ï¼ˆ3,000å††ã€œï¼‰</label>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="15000" data-imgs="https://raw.githubusercontent.com/5442mako/image-host-/main/image216.webp"> ç´°ã‹ã„èƒŒæ™¯ï¼ˆ15,000å††ã€œï¼‰</label>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="5000" > ç´°ã‹ã„è£…é£¾ï¼ˆ5,000å††ï¼‰</label>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="5000" > ã¬ã„ãã‚‹ã¿ï¼ˆå‹•ç‰©ãªã©ï¼‰ãƒ»å¤§ãã‚ã‚¢ã‚¯ã‚»ï¼ˆ5,000å††ï¼‰</label>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="10000"> è¿½åŠ è¡£è£…ï¼ˆ1ç€ã”ã¨10,000å††ï¼‰</label>
      <label><input type="checkbox" class="option additional-option-item" name="additionalOption" value="5000"> å•†ç”¨åˆ©ç”¨ï¼ˆ5,000å††ï¼‰</label>
      <label><input type="checkbox" class="option" id="noOptionCheckbox" name="additionalOption" value="0"> è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã—</label>
      <div id="optionPreview" class="preview"></div>

      <h3>ã€åˆè¨ˆã€‘</h3>
      <div class="total">ç°¡æ˜“è¦‹ç©åˆè¨ˆé‡‘é¡ï¼šÂ¥<span id="total">0</span></div>
      <div class="estimate-note">
        â€»ã“ã®é‡‘é¡ã¯ã‚ãã¾ã§ç›®å®‰ã§ã™ã€‚<br>
        â€»å®Ÿéš›ã®è²»ç”¨ã¯å†…å®¹ã‚’ç¢ºèªã®ã†ãˆã€<br>æ­£å¼ã«ãŠè¦‹ç©ã‚‚ã‚Šã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
      </div>
      
      <h3 id="contactInfoSectionH3">ã€ã”é€£çµ¡å…ˆã€‘</h3>
      <p>ãŠåå‰orãƒãƒ³ãƒ‰ãƒ«ãƒãƒ¼ãƒ <span class="required-note">â€»å¿…é ˆã€‚</span></p>
      <input type="text" id="name" placeholder="â€»ä¾‹ï¼šèŠ±æŸã®ä½äººã€yamada100" name="name">
      <p id="nameErrorMessage" class="error-message is-hidden">â€»ãŠåå‰orãƒãƒ³ãƒ‰ãƒ«ãƒãƒ¼ãƒ ã‚’ã”å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
      <p>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="required-note">â€»å¿…é ˆã€‚</span></p>
      <input type="email" id="email" placeholder="â€»ä¾‹ï¼šexample@gmail.com" name="email">
      <p id="emailErrorMessage" class="error-message is-hidden">â€»æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã”å…¥åŠ›ãã ã•ã„ã€‚</p>
      
      <h3>ã€ã”ä¾é ¼ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€‘<span class="required-note">â€»å¿…é ˆã€‚</span></h3>
      <textarea id="note" placeholder="ã”è¦æœ›ãŒã‚ã‚Œã°ã”è‡ªç”±ã«ã”è¨˜å…¥ãã ã•ã„ã€‚ä¾‹ï¼šé«ªè‰²ãƒ»æœè£…ãƒ»æ€§æ ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ä½¿ç”¨ç›®çš„ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ãƒ»Live2Dãªã©ï¼‰ï¼ãƒãƒ¼ã‚ºã‚„æ§‹å›³ï¼èƒŒæ™¯ã®æœ‰ç„¡ ãªã©" rows="30" name="note">

ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

ã€ç´æœŸã€‘ï¼š
ã€ç´æœŸã®å‰å€’ã—ã®å¯å¦ã€‘ï¼š
ã€ä½¿ç”¨ç”¨é€”ã€‘ï¼š
ã€ã‚¤ãƒ©ã‚¹ãƒˆã‚µã‚¤ã‚ºã€‘ï¼š
ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã€‘ï¼š
ã€ç´å“å½¢å¼ã€‘ï¼š
ã€ã‚­ãƒ£ãƒ©ã®å¹´é½¢ã€‘ï¼š
ã€ã”å¸Œæœ›ã®é ­èº«ã€‘ï¼š
ã€ã”å¸Œæœ›ã®æ§‹å›³ã€‘ï¼š
ã€ã”å¸Œæœ›ã®ãƒãƒ¼ã‚ºã€‘ï¼š
ã€é›°å›²æ°—ã€‘ï¼š
ã€è¡¨æƒ…ã€‘ï¼š

ã€å®Ÿç¸¾å…¬é–‹å¯èƒ½æ—¥æ™‚ã€‘ï¼š

ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
ä»»æ„æ¬„

â—ã”ä¾é ¼æ¤œè¨ã®æ±ºã‚æ‰‹ã¨ãªã£ãŸã‚¤ãƒ©ã‚¹ãƒˆãªã©ãŒã‚ã‚Œã°ãŠæ•™ãˆãã ã•ã„

â—ãã®ä»–ã”ç›¸è«‡ã—ãŸã„äº‹ãªã©ã”ã–ã„ã¾ã—ãŸãŠæ•™ãˆãã ã•ã„

è©³ç´°è³‡æ–™ãªã©ã”ã–ã„ã¾ã—ãŸã‚‰ã”æç¤ºé ‚ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
ãŠæ‰‹æ•°ãŠæ›ã‘è‡´ã—ã¾ã™ãŒã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„è‡´ã—ã¾ã™ã€‚
</textarea>
      
      <h3>ã€å‚è€ƒç”»åƒï¼ˆæ·»ä»˜ï¼‰ã€‘</h3>
      <input type="file" id="imageFile" accept="image/*" multiple name="imageFile">
      <p class="section-description">â€»å‚è€ƒè³‡æ–™ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ç”»åƒã‚’æ·»ä»˜ã—ã¦ãã ã•ã„ã€‚<br>Windowsã®æ–¹ã¯Ctrlã‚­ãƒ¼ã€Macã®æ–¹ã¯Commandã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã§ãã¾ã™ã€‚ï¼ˆæœ€å¤§5æšï¼‰</p>
      <div id="filePreviewContainer"></div>
      <p id="fileErrorMessage" class="error-message is-hidden">â€»ãƒ•ã‚¡ã‚¤ãƒ«ã¯5æšã¾ã§ã—ã‹é¸æŠã§ãã¾ã›ã‚“ã€‚</p>
      <button id="submitBtn" type="submit">é€ä¿¡</button>
    </form>
  </div>
</div>

<div id="completeMessage" class="complete is-hidden">
  <h2>é€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h2>
  <p>ãŠå•ã„åˆã‚ã›ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
  <p>ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’ç¢ºèªæ¬¡ç¬¬ã€3å–¶æ¥­æ—¥ä»¥å†…ã«ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚</p>
  <p>3å–¶æ¥­æ—¥ã‚’éãã¦ã‚‚è¿”ä¿¡ãŒãªã„å ´åˆã¯ã€<br>ãŠæ‰‹æ•°ã§ã™ãŒã€Xã®DMã«ã¦ã”é€£çµ¡ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p>
</div>

<div id="loadingOverlay">
  <div class="spinner"></div>
  <div id="loadingText">é€ä¿¡ä¸­ã§ã™...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚</div>
</div>

<div id="previewPanel">
  <h4>é¸æŠå†…å®¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
  <p><strong>ã‚¤ãƒ©ã‚¹ãƒˆã‚¿ã‚¤ãƒ—:</strong> <span id="previewType">æœªé¸æŠ</span></p>
  <p><strong>è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³:</strong> <span id="previewOptions">ãªã—</span></p>
  <p><strong>ç°¡æ˜“è¦‹ç©åˆè¨ˆé‡‘é¡ï¼š</strong> <span id="previewTotal" class="preview-total-highlight">0</span></p>
</div>

<div class="popup-overlay" id="popupOverlay">
  <img id="popupImage" src="" alt="æ‹¡å¤§ç”»åƒ" loading="lazy" decoding="async">
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOMè¦ç´ ã®å–å¾— ---
    const formContainer = document.getElementById("formContainer");
    const completeMessage = document.getElementById("completeMessage");
    const estimateForm = document.getElementById("estimateForm");
    const totalEl = document.getElementById("total");
    const submitBtn = document.getElementById("submitBtn");
    const optionPreviewContainer = document.getElementById("optionPreview");
    const typePreviewContainer = document.getElementById('typeImageBelowOptions');
    const radios = document.querySelectorAll('input[name="type"]');
    const allOptionCheckboxes = document.querySelectorAll('.option');
    const noOptionCheckbox = document.getElementById('noOptionCheckbox');
    const actualOptionItems = document.querySelectorAll('.additional-option-item');
    const previewPanel = document.getElementById('previewPanel');
    const popupOverlay = document.getElementById("popupOverlay");
    const popupImage = document.getElementById("popupImage");
    const previewTypeEl = document.getElementById("previewType");
    const previewOptionsEl = document.getElementById("previewOptions");
    const previewTotalEl = document.getElementById("previewTotal");
    const nameInput = document.getElementById("name");
    const emailInput = document.getElementById("email");
    const noteTextarea = document.getElementById("note");
    const imageFileInput = document.getElementById("imageFile");
    const nameErrorMessage = document.getElementById("nameErrorMessage");
    const emailErrorMessage = document.getElementById("emailErrorMessage");
    const typeErrorMessage = document.getElementById("typeErrorMessage");
    const fileErrorMessage = document.getElementById("fileErrorMessage");
    const illustrationTypeSectionH3 = document.getElementById("illustrationTypeSectionH3");
    const contactInfoSectionH3 = document.getElementById("contactInfoSectionH3");
    const filePreviewContainer = document.getElementById('filePreviewContainer');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');

    let selectedFiles = [];
    // GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URL
    const gasUrl = "https://script.google.com/macros/s/AKfycbyLQx1iosCLUa58xtnfQAkFddZiR0kgVN9nAAjcrB6flj-E5_wdAlsHeGbOf3rChFhY/exec";

    const showLoading = (text) => {
        loadingText.textContent = text;
        loadingOverlay.style.opacity = '1';
        loadingOverlay.style.visibility = 'visible';
    };

    const hideLoading = () => {
        loadingOverlay.style.opacity = '0';
        loadingOverlay.style.visibility = 'hidden';
    };

    const showPopup = (src) => {
        popupImage.src = src;
        popupOverlay.style.display = "flex";
    };
    const hidePopup = () => {
        popupOverlay.style.display = "none";
    };

    const updatePreviewPanel = () => {
        const selectedTypeRadio = document.querySelector('input[name="type"]:checked');
        previewTypeEl.textContent = selectedTypeRadio ? selectedTypeRadio.parentElement.textContent.trim().replace(/ï¼ˆ[\d,]+å††ï¼‰$/, '') : "æœªé¸æŠ";

        let optionsText = "ãªã—";
        if (noOptionCheckbox?.checked) {
            optionsText = noOptionCheckbox.parentElement.textContent.trim().replace(/ï¼ˆ[\d,]+å††ï¼‰$/, '');
        } else {
            const checkedOptions = Array.from(actualOptionItems).filter(opt => opt.checked);
            if (checkedOptions.length > 0) {
                optionsText = checkedOptions.map(opt => opt.parentElement.textContent.trim().replace(/ï¼ˆ[\d,]+å††ï¼‰$/, '')).join(", ");
            }
        }
        previewOptionsEl.textContent = optionsText;
        previewTotalEl.textContent = "Â¥" + totalEl.textContent;
    };

    const calculateTotal = () => {
        let total = 0;
        const selectedType = document.querySelector('input[name="type"]:checked');
        if (selectedType) total += parseInt(selectedType.value, 10);

        if (!noOptionCheckbox?.checked) {
            actualOptionItems.forEach(opt => {
                if (opt.checked) total += parseInt(opt.value, 10);
            });
        }
        totalEl.textContent = total.toLocaleString();
        updatePreviewPanel();
    };

    const createPreviewImage = (url, altText, container, isOption = false) => {
        const img = document.createElement('img');
        img.src = url;
        img.alt = altText;
        img.loading = 'lazy';
        img.decoding = 'async';
        img.style.cursor = 'pointer';
        img.style.borderRadius = '6px';
        img.onclick = () => showPopup(img.src);

        if (isOption) {
            img.style.maxWidth = "150px";
            img.style.maxHeight = "150px";
        } else {
            img.style.maxWidth = '50%';
            img.style.maxHeight = '200px';
            img.style.boxSizing = 'border-box';
            img.style.padding = '0 5px';
            img.style.display = 'inline-block';
        }

        container.appendChild(img);
    };

    const updateTypePreview = () => {
        typePreviewContainer.innerHTML = '';
        const selected = document.querySelector('input[name="type"]:checked');
        if (selected?.dataset.imgs) {
            const imageUrls = selected.dataset.imgs.split(',').map(url => url.trim()).filter(Boolean);
            if (imageUrls.length > 0) {
                imageUrls.forEach(url => createPreviewImage(url, "ã‚¿ã‚¤ãƒ—ç”»åƒ", typePreviewContainer));
                const note = document.createElement("p");
                note.textContent = "â€»ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ‹¡å¤§ã—ã¾ã™ã€‚";
                note.className = "preview-note";
                typePreviewContainer.appendChild(note);
            }
        }
    };

    const updateOptionPreview = () => {
        optionPreviewContainer.innerHTML = '';
        actualOptionItems.forEach(opt => {
            if (opt.checked && opt.dataset.imgs) {
                const wrapper = document.createElement("div");
                wrapper.className = "optionImageWrapper";
                createPreviewImage(opt.dataset.imgs, "ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”»åƒ", wrapper, true);

                const note = document.createElement("p");
                note.textContent = "â€»ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ‹¡å¤§ã—ã¾ã™ã€‚";
                note.className = "preview-note";
                wrapper.appendChild(note);
                optionPreviewContainer.appendChild(wrapper);
            }
        });
    };

    const renderFilePreview = () => {
        filePreviewContainer.innerHTML = '';
        selectedFiles.forEach((file, index) => {
            const previewItem = document.createElement('div');
            previewItem.className = 'file-preview-item';
            const fileName = document.createElement('span');
            fileName.textContent = file.name;
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'å‰Šé™¤';
            removeBtn.onclick = () => {
                selectedFiles.splice(index, 1);
                renderFilePreview();
                if (selectedFiles.length === 0) {
                    imageFileInput.value = '';
                }
            };
            previewItem.appendChild(fileName);
            previewItem.appendChild(removeBtn);
            filePreviewContainer.appendChild(previewItem);
        });
    };

    const handleSubmit = async (event) => {
        event.preventDefault();
        let hasError = false;
        let firstErrorElement = null;

        radios.forEach(input => input.parentElement.classList.remove("highlight-error"));
        typeErrorMessage.classList.add('is-hidden');
        nameInput.classList.remove("input-error");
        nameErrorMessage.classList.add("is-hidden");
        emailInput.classList.remove("input-error");
        emailErrorMessage.classList.add("is-hidden");
        fileErrorMessage.classList.add("is-hidden");

        const selectedType = document.querySelector('input[name="type"]:checked');
        if (!selectedType) {
            hasError = true;
            firstErrorElement = illustrationTypeSectionH3;
            radios.forEach(input => input.parentElement.classList.add("highlight-error"));
            typeErrorMessage.classList.remove('is-hidden');
        }

        const name = nameInput.value.trim();
        if (!name) {
            hasError = true;
            nameInput.classList.add("input-error");
            nameErrorMessage.classList.remove("is-hidden");
            if (!firstErrorElement) firstErrorElement = contactInfoSectionH3;
        }

        const email = emailInput.value.trim();
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            hasError = true;
            emailInput.classList.add("input-error");
            emailErrorMessage.classList.remove("is-hidden");
            if (!firstErrorElement) firstErrorElement = contactInfoSectionH3;
        }

        if (selectedFiles.length > 5) {
            hasError = true;
            fileErrorMessage.classList.remove('is-hidden');
        }

        if (hasError) {
            firstErrorElement?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return;
        }

        submitBtn.disabled = true;
        showLoading("é€ä¿¡ä¸­ã§ã™...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚");

        const selectedTypeLabel = selectedType.parentElement.textContent.trim();
        const note = noteTextarea.value;
        const total = totalEl.textContent.replace(/,/g, '');
        const optionLabels = noOptionCheckbox.checked
            ? ['è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã—']
            : Array.from(document.querySelectorAll('.additional-option-item:checked')).map(opt => opt.parentElement.textContent.trim());

        const fileDataArray = [];
        for (const file of selectedFiles) {
            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
            fileDataArray.push({
                fileName: file.name,
                data: base64
            });
        }

        const data = {
            name: name,
            email: email,
            total: total,
            note: note,
            typeLabel: selectedTypeLabel,
            optionLabels: optionLabels,
            images: fileDataArray
        };

        try {
            const response = await fetch(gasUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                // mode: 'cors' ã‚’è¿½åŠ 
                mode: 'cors',
                body: JSON.stringify(data)
            });

            if (response.ok) {
                hideLoading();
                formContainer.classList.add("is-hidden");
                completeMessage.classList.remove("is-hidden");
                previewPanel?.classList.add("is-hidden");
            } else {
                throw new Error('GASã¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        } catch (error) {
            hideLoading();
            submitBtn.disabled = false;
            alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n" + error.message);
        }
    };

    // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
    radios.forEach(radio => {
        radio.addEventListener('change', () => {
            calculateTotal();
            updateTypePreview();
        });
    });

    allOptionCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            if (checkbox.id === 'noOptionCheckbox') {
                actualOptionItems.forEach(item => {
                    item.disabled = checkbox.checked;
                    if (checkbox.checked) {
                        item.checked = false;
                    }
                });
            } else {
                if (checkbox.checked) {
                    noOptionCheckbox.checked = false;
                }
            }
            calculateTotal();
            updateOptionPreview();
        });
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    imageFileInput.addEventListener('change', (event) => {
        fileErrorMessage.classList.add("is-hidden");
        const newFiles = Array.from(event.target.files);

        if (newFiles.length > 5) {
            fileErrorMessage.classList.remove('is-hidden');
            imageFileInput.value = '';
            selectedFiles = [];
        } else {
            selectedFiles = newFiles;
        }
        renderFilePreview();
    });

    estimateForm.addEventListener('submit', handleSubmit);
    popupOverlay.addEventListener('click', hidePopup);

    // Responsive panel movement
    const originalPreviewPanelParent = previewPanel?.parentElement;
    const originalPreviewPanelNextSibling = previewPanel?.nextSibling;
    const movePreviewPanel = () => {
        if (!previewPanel || !estimateForm || !submitBtn) return;
        if (window.innerWidth <= 980) {
            if (previewPanel.parentElement !== estimateForm) {
                estimateForm.insertBefore(previewPanel, submitBtn);
            }
        } else {
            if (previewPanel.parentElement === estimateForm) {
                originalPreviewPanelParent.insertBefore(previewPanel, originalPreviewPanelNextSibling);
            }
        }
    };
    window.addEventListener('resize', movePreviewPanel);

    // åˆæœŸåŒ–
    calculateTotal();
    updateTypePreview();
    updateOptionPreview();
    movePreviewPanel();
});
</script>
</body>
</html>
