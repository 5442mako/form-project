<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>イラスト見積もりフォーム</title>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background-color: #f4f4f9;
      display: flex;
      justify-content: center;
      padding: 40px;
    }
    .container {
      background: white;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 700px;
    }
    h2, h3 { color: #333; }
    h3 {
      background-color: #eef1f9;
      padding: 10px;
      border-left: 5px solid #446dff;
      font-size: 1.1em;
      margin-top: 30px;
    }
    label { display: block; margin: 6px 0; color: #222; }
    input[type="text"], input[type="email"], textarea {
      width: 100%; padding: 8px; margin-top: 6px; margin-bottom: 20px;
      border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;
    }
    input[type="file"] { margin-bottom: 20px; }
    button {
      background-color: #446dff; color: white; padding: 12px 20px;
      border: none; border-radius: 6px; font-size: 1em; width: 100%;
      cursor: pointer; margin-top: 20px;
    }
    button[disabled] { background-color: #888; cursor: not-allowed; }
    .preview img {
      max-width: 100%; max-height: 200px; margin-top: 10px; border-radius: 6px;
    }
    .total { font-size: 1.4em; color: #2c7a00; font-weight: bold; text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>イラスト見積もりフォーム</h2>
    <form id="estimateForm" onsubmit="submitForm(event)">

      <!--希望のイラスト選択（ラジオボタン）-->
      <h3>ご希望のイラストタイプ</h3>
      <div id="typePreview" class="preview"></div>
      <label><input type="radio" name="type" value="5000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 顔アップ（5,000円）</label>
      <label><input type="radio" name="type" value="8000" data-img="./images/559117789085565435.jpg"> バストアップ（8,000円）</label>
      <label><input type="radio" name="type" value="10000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 膝上（10,000円）</label>
      <label><input type="radio" name="type" value="13000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 全身（13,000円）</label>
      <label><input type="radio" name="type" value="40000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> Live2D用イラストパーツ分け（40,000円）</label>
      <label><input type="radio" name="type" value="25000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> Live2Dバストアップ（25,000円）</label>
      <label><input type="radio" name="type" value="15000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> キャラ・衣装デザイン（15,000円）</label>

      <!--イラストタイプの画像表示-->
      <div id="typeImageBelowOptions" class="preview"></div>

      <!--追加オプション選択（チェックボックス）-->
      <h3>追加オプション（複数選択可）</h3>
      <div id="optionPreview" class="preview"></div>
      <label><input type="checkbox" class="option" value="5000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 背景（5,000円）</label>
      <label><input type="checkbox" class="option" value="15000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 細かい背景（15,000円）</label>
      <label><input type="checkbox" class="option" value="5000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 細かい装飾（5,000円）</label>
      <label><input type="checkbox" class="option" value="5000" data-img="./images/fec976d1-b412-4286-b968-e8b672f86fd5.png"> 動物・大きめアクセ（5,000円）</label>
      <label><input type="checkbox" class="option" value="10000"> 追加衣装（1着ごと10,000円）</label>
      <label><input type="checkbox" class="option" value="5000"> 商用利用（5,000円）</label>

      <!--追加オプションの画像表示-->
      <div class="total">合計金額：¥<span id="total">0</span></div>


      <h3>ご連絡先</h3>
      <input type="text" id="name" placeholder="お名前" required>
      <input type="email" id="email" placeholder="メールアドレス" required>

      <h3>ご要望</h3>
      <textarea id="note" rows="4" placeholder="ご要望など"></textarea>

      <h3>参考画像（添付）</h3>
      <input type="file" id="imageFile" accept="image/*">

      <button type="submit" id="submitBtn">送信</button>
    </form>
  </div>

  <script>
    const radios = document.querySelectorAll('input[name="type"]');
    const checkboxes = document.querySelectorAll('.option');
    const totalEl = document.getElementById('total');
    const submitBtn = document.getElementById('submitBtn');

    function calculateTotal() {
      let total = 0;
      const selected = document.querySelector('input[name="type"]:checked');
      if (selected) total += parseInt(selected.value);
      checkboxes.forEach(opt => { if (opt.checked) total += parseInt(opt.value); });
      totalEl.textContent = total.toLocaleString();
    }

    function updateTypePreview() {
      const selected = document.querySelector('input[name="type"]:checked');
      const existing = document.getElementById("typeImagePreview");
      if (existing) existing.remove();
      if (selected && selected.dataset.img) {
        const img = document.createElement("img");
        img.src = selected.dataset.img;
        img.alt = "タイプ画像";
        img.id = "typeImagePreview";
        document.getElementById("typeImageBelowOptions").appendChild(img);
      }
    }

    function updateOptionPreview() {
      const existingOptions = document.querySelectorAll('.optionImagePreview');
      existingOptions.forEach(el => el.remove());
      checkboxes.forEach(opt => {
        if (opt.checked && opt.dataset.img) {
          const img = document.createElement("img");
          img.src = opt.dataset.img;
          img.className = "optionImagePreview";
          document.getElementById("optionPreview").appendChild(img);
        }
      });
    }

    function submitForm(event) {
      event.preventDefault();
      const data = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        note: document.getElementById("note").value,
        total: document.getElementById("total").textContent,
        typeLabel: document.querySelector('input[name="type"]:checked')?.parentElement.textContent.trim() || "",
        optionLabels: Array.from(document.querySelectorAll('.option:checked')).map(opt => opt.parentElement.textContent.trim()),
        image: null
      };

      const file = document.getElementById("imageFile").files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          data.image = e.target.result;
          sendToGAS(data);
        };
        reader.readAsDataURL(file);
      } else {
        sendToGAS(data);
      }
    }

    function sendToGAS(data) {
      fetch("YOUR_GAS_DEPLOYMENT_URL", {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.ok ? alert("送信完了しました！") : alert("送信に失敗しました。"))
      .catch(error => alert("通信エラー: " + error.message));
    }

    radios.forEach(r => r.addEventListener('change', () => { calculateTotal(); updateTypePreview(); }));
    checkboxes.forEach(c => c.addEventListener('change', () => { calculateTotal(); updateOptionPreview(); }));
    document.addEventListener('DOMContentLoaded', () => { calculateTotal(); updateTypePreview(); updateOptionPreview(); });
  </script>
</body>
</html>
